library IEEE;
use IEEE.std_logic_1164.all;
use IEEE.numeric_std.all;
use  IEEE.STD_LOGIC_ARITH.all;
use  IEEE.STD_LOGIC_UNSIGNED.all;

entity tank is
	generic(
		x_start, y_start : natural;
		tank_size : natural
	);
	port(
		-- inputs
		clk, rst : in std_logic;
		speed : in std_logic_vector(2 downto 0);
		
		-- coordinate outputs
		x_out, y_out : out std_logic_vector(9 downto 0)
	);

end entity tank;

architecture behavioral of tank is 
	-- x, y signals
	signal x_curr : std_logic_vector(9 downto 0) := std_logic_vector(to_unsigned(x_start, 10));
	signal x_nxt : std_logic_vector(9 downto 0) := std_logic_vector(to_unsigned(x_start, 10));
	signal y_t : std_logic_vector(9 downto 0) := std_logic_vector(to_unsigned(y_start, 10));
	
	-- tank direction (state)
	type state is (l_dir, r_dir);
	
	-- state declaration
	signal dir_curr : state := l_dir;
	signal dir_nxt : state := l_dir;
	
begin
	clk_process : process(clk, rst)
	begin
		if (rst = '1') then
			curr <= l_dir;
			x_curr <= std_logic_vector(to_unsigned(x_start, 10));
		elsif (rising_edge(clk)) then
			x_out <= x_nxt;
			x_curr <= x_nxt;			
		end if;
	end process clk_process;

	
	direction_process : process(x_curr, dir_curr)
	begin
		-- left or right
		case dir_curr is
			when l_dir =>
				if (x_curr < std_logic_vector(to_unsigned(tank_size, 10))) then
					-- switch directions and move in a different direction
					dir_nxt <= r_dir;
				else
					dir_nxt <= l_dir;
				end if;
			when r_dir =>
				if (x_curr > std_logic_vector(to_unsigned(640 - tank_size, 10))) then
					dir_nxt <= l_dir;
				else
					dir_curr <= r_dir;
				end if;
		end case;
		
		case dir_nxt is
			when l_dir =>
				if (speed = '10') then -- fast
					x_nxt <= x_curr - 10;
				elsif (speed == '01') then -- medium
					x_nxt <= x_curr - 5;
				else	-- slow
					x_nxt <= x_curr - 2;
				end if;
			when r_dir =>
				if (speed = '10') then -- fast
					x_nxt <= x_curr + 10;
				elsif (speed == '01') then -- medium
					x_nxt <= x_curr + 5;
				else	-- slow
					x_nxt <= x_curr + 2;
				end if;
		end case;
	end process direction_process;
	
end architecture behavioral;